<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>æ±‚äººãƒãƒ£ãƒƒãƒˆ</title>
    <style>
        #chat-box { 
            border: 1px solid #ccc; 
            padding: 10px; 
            height: 300px; 
            overflow-y: scroll; 
            white-space: pre-wrap; /* æ”¹è¡Œã‚’åæ˜  */
        }
        .user { color: blue; }
        .ai { color: green; }
    </style>
</head>
<body>
    <h2>æ±‚äººææ¡ˆãƒãƒ£ãƒƒãƒˆ</h2>
    <div id="chat-box">
        {% if initial_message %}
            <p class="ai">ğŸ¤–: {{ initial_message|safe }}</p>
        {% endif %}
    </div>

    <form id="chat-form">
        <input type="text" id="user-input" placeholder="å¸Œæœ›æ¡ä»¶ã‚„è³ªå•ã‚’å…¥åŠ›">
        <button type="submit">é€ä¿¡</button>
    </form>

<script>
document.getElementById("chat-form").onsubmit = async (e) => {
    e.preventDefault();
    const msg = document.getElementById("user-input").value;

    const chatBox = document.getElementById("chat-box");

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™ºè©±ã‚’è¿½åŠ 
    const userDiv = document.createElement("p");
    userDiv.className = "user";
    userDiv.textContent = "ğŸ‘¤: " + msg;
    chatBox.appendChild(userDiv);

    // Flask APIã¸é€ä¿¡
    const res = await fetch("/api/chat", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({message: msg})
    });

    const data = await res.json();

    // AIå¿œç­”ã‚’è¿½åŠ ï¼ˆæ”¹è¡Œã‚’åæ˜ ï¼‰
    const aiDiv = document.createElement("p");
    aiDiv.className = "ai";
    aiDiv.innerHTML = "ğŸ¤–:<br>" + data.reply.replace(/\n/g, "<br>");
    chatBox.appendChild(aiDiv);

    // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
    document.getElementById("user-input").value = "";

    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ä¸€ç•ªä¸‹ã«
    chatBox.scrollTop = chatBox.scrollHeight;
};
</script>
</body>
</html>